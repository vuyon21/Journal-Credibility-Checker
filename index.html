<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UFS Journal Credibility Checker</title>
  <style>
    :root {
      --brand: #0F204B;
      --accent: #A71930;
      --removed: #8B8D8E;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
    }

    * { box-sizing: border-box; }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      background: linear-gradient(135deg, #f5f7fa, #e4e8f0);
      padding: 20px;
      color: #222;
      line-height: 1.6;
    }

    .container { max-width: 960px; margin: 0 auto; }
    
    header {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 18px;
      box-shadow: 0 4px 10px rgba(0,0,0,.06);
      text-align: center;
    }
    
    h1 { 
      color: var(--brand); 
      margin: 0 0 6px; 
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .subtitle { color: #666; font-size: 14px; }

    .card {
      background: #fff;
      padding: 22px;
      border-radius: 10px;
      box-shadow: 0 6px 20px rgba(0,0,0,.05);
    }

    .search-row {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 15px;
    }
    
    input[type="text"] {
      flex: 2;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 15px;
    }
    
    button {
      padding: 11px 14px;
      border-radius: 8px;
      border: 0;
      cursor: pointer;
      background: var(--brand);
      color: #fff;
      font-weight: 600;
      transition: background-color 0.2s;
    }
    
    button:hover {
      background: #1a3170;
    }
    
    .small-btn { 
      padding: 9px 12px; 
      background: var(--accent); 
    }
    
    .small-btn:hover {
      background: #c41c34;
    }
    
    .button-row { 
      display: flex; 
      gap: 10px; 
      flex-wrap: wrap; 
      margin-top: 14px; 
    }

    pre#journal-report {
      display: none;
      white-space: pre-wrap;
      background: #f8f9fa;
      padding: 18px;
      border-radius: 8px;
      border: 1px solid #e4e8f0;
      margin-top: 14px;
      max-height: 420px;
      overflow: auto;
      font-family: monospace;
      line-height: 1.5;
    }

    .status { 
      margin-top: 10px; 
      text-align: center; 
      display: none; 
      padding: 10px; 
      border-radius: 8px; 
    }
    
    .status.loading { 
      background: #fff3cd; 
      color: #856404; 
      border: 1px solid #ffeaa7; 
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    
    .status.error { 
      background: #ffebee; 
      color: #c0392b; 
      border: 1px solid #f8d7da; 
    }

    .recommendation {
      display: none;
      margin-top: 12px;
      padding: 12px;
      border-radius: 8px;
      font-weight: 600;
    }
    
    .recommendation.recommended { 
      background: #d4edda; 
      color: #155724; 
      border: 1px solid #c3e6cb; 
    }
    
    .recommendation.verify { 
      background: #fff3cd; 
      color: #856404; 
      border: 1px solid #ffeaa7; 
    }
    
    .recommendation.not-recommended { 
      background: #f8d7da; 
      color: #721c24; 
      border: 1px solid #f5c6cb; 
    }

    .footer { 
      margin-top: 22px; 
      text-align: center; 
      color: #555; 
      font-size: 14px;
    }

    /* Autocomplete */
    .autocomplete { 
      position: relative; 
      flex: 1;
    }
    
    #autocomplete-results {
      position: absolute; 
      left: 0; 
      right: 0; 
      top: 100%; 
      z-index: 1000;
      background: #fff;
      border: 1px solid #ddd;
      border-top: 0;
      border-radius: 0 0 8px 8px;
      display: none;
      max-height: 200px;
      overflow: auto;
    }
    
    .autocomplete-item { 
      padding: 10px; 
      border-bottom: 1px solid #f1f1f1; 
      cursor: pointer; 
    }
    
    .autocomplete-item:hover { 
      background: #f0f8ff; 
    }

    @media (max-width: 640px) {
      .search-row { 
        flex-direction: column; 
      }
      
      .button-row {
        flex-direction: column;
      }
    }

    /* Modal */
    .modal-overlay {
      display: none;
      position: fixed;
      z-index: 2000;
      left: 0; 
      top: 0; 
      right: 0; 
      bottom: 0;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
    }
    
    .modal-content {
      background: #fff;
      border-radius: 12px;
      width: 90%;
      max-width: 800px;
      height: 80%;
      padding: 20px;
      overflow-y: auto;
      position: relative;
    }
    
    .modal-close {
      position: absolute;
      top: 10px; 
      right: 20px;
      font-size: 24px;
      cursor: pointer;
      color: #333;
    }
    
    .table-container { 
      overflow: auto; 
      max-height: 90%; 
      margin-top: 20px; 
    }
    
    #removed-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    #removed-table th, #removed-table td {
      padding: 8px 12px;
      border: 1px solid #ddd;
      text-align: left;
    }
    
    #removed-table th {
      background: var(--brand);
      color: #fff;
      position: sticky; 
      top: 0;
    }
    
    #removed-table tr:nth-child(even) { 
      background: #f9f9f9; 
    }
    
    .spinner {
      width: 20px;
      height: 20px;
      border: 3px solid rgba(0, 0, 0, 0.1);
      border-top: 3px solid var(--brand);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
<div class="container">
  <header>
    <h1><i class="fas fa-book-journal-whills"></i> UFS Journal Credibility Checker</h1>
    <div class="subtitle">
      Evaluates journal credibility via accredited lists and live lookups from trusted sources
    </div>
  </header>

  <div class="card">
    <div class="search-row">
      <div class="autocomplete">
        <input id="journal-query" type="text" placeholder="Enter journal title or ISSN (e.g. Nature or 0028-0836)">
        <div id="autocomplete-results"></div>
      </div>
      <button id="check-btn">Check</button>
      <button id="copy-report-btn" class="small-btn">üìã Copy Report</button>
      <button id="download-report-btn" class="small-btn">üíæ Download Report</button>
    </div>

    <div class="button-row">
      <button id="show-removed-btn" style="background:var(--removed)">üóëÔ∏è Show Removed Journals</button>
      <button id="copy-removed-btn" style="background:var(--accent)">üìã Copy Removed Journals</button>
    </div>

    <div class="status loading" id="loading-message">
      <div class="spinner"></div>
      <span>Loading journal data...</span>
    </div>
    <div class="status error" id="error-message"></div>

    <pre id="journal-report"></pre>
    <div id="recommendation" class="recommendation"></div>

    <div class="footer">
      Note: Always confirm scope match with your discipline before submission.
    </div>
  </div>
</div>

<!-- Removed Journals Modal -->
<div id="removed-modal" class="modal-overlay">
  <div class="modal-content">
    <span id="close-removed" class="modal-close">&times;</span>
    <h2>Removed Journals</h2>
    <div class="table-container">
      <table id="removed-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>ISSN</th>
            <th>Year Removed</th>
            <th>Date of Last Review</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>
</div>

<script>
// ===================== CONFIG =====================
const RAW_BASE = 'https://raw.githubusercontent.com/vuyon21/Journal-Credibility-Checker/main/';

const FILENAMES = {
  dhet: 'DHET_2025.csv',
  doaj: 'DOAJ_2025.csv',
  ibss: 'IBSS_2025.csv',
  norwegian: 'NORWEGIAN_2025.csv',
  other: 'OTHER INDEXED JOURNALS_2025.csv',
  scielo: 'SCIELO SA_2025.csv',
  scopus: 'SCOPUS_2025.csv',
  wos: 'WOS_2025.csv',
  removed: 'JOURNALS REMOVED IN PAST YEARS.csv'
};

const TRANSFORMATIVE_FILES = [
  {file:'WILEY_2025.csv', link:'https://sanlic.ac.za/wiley/'},
  {file:'The Company of Biologists_2025.csv', link:'https://sanlic.ac.za/the-company-of-biologists/'},
  {file:'Taylor & Francis_2025.csv', link:'https://sanlic.ac.za/taylor-francis/'},
  {file:'Springer_2025.csv', link:'https://sanlic.ac.za/springer/'},
  {file:'ScienceDirect (Elsevier)_2025.csv', link:'https://sanlic.ac.za/sciencedirect-elsevier/'},
  {file:'SAGE Publishing_2025.csv', link:'https://sanlic.ac.za/sage-publishing/'},
  {file:'Royal Society_2025.csv', link:'https://sanlic.ac.za/royal-society/'},
  {file:'Royal Society of Chemistry Platinum_2025.csv', link:'https://sanlic.ac.za/royal-society-of-chemistry/'},
  {file:'Oxford University Press Journals_2025.csv', link:'https://sanlic.ac.za/oxford-university-press-journals/'},
  {file:'IOPscienceExtra_2025.csv', link:'https://sanlic.ac.za/iopscience-extra/'},
  {file:'Emerald_2025.csv', link:'https://sanlic.ac.za/emerald/'},
  {file:'Cambridge University Press (CUP)_2025.csv', link:'https://sanlic.ac.za/cambridge-university-press/'},
  {file:'Bentham Science Publishers_2025.csv', link:'https://sanlic.ac.za/bentham-science-publishers-2/'},
  {file:'Association for Computing Machinery (ACM)_2025.csv', link:'https://sanlic.ac.za/association-for-computing-machinery-acm/'},
  {file:'American Institute of Physics (AIP)_2025.csv', link:'https://sanlic.ac.za/american-institute-of-physics-2/'},
  {file:'American Chemical Society (ACS)_2025.csv', link:'https://sanlic.ac.za/american-chemical-society-acs/'}
];

const $ = id => document.getElementById(id);

const journalQuery = $('journal-query');
const checkBtn = $('check-btn');
const autocompleteResults = $('autocomplete-results');
const copyReportBtn = $('copy-report-btn');
const downloadReportBtn = $('download-report-btn');
const showRemovedBtn = $('show-removed-btn');
const copyRemovedBtn = $('copy-removed-btn');
const journalReport = $('journal-report');
const loadingMessage = $('loading-message');
const errorMessage = $('error-message');
const recommendation = $('recommendation');
const removedModal = $('removed-modal');
const closeRemoved = $('close-removed');
const removedTableBody = $('removed-table').querySelector('tbody');

let journalLists = { dhet:[], doaj:[], ibss:[], norwegian:[], other:[], scielo:[], scopus:[], wos:[], removed:[] };
let transformativeList = [];

// Sample data for demonstration when CSV fetching fails
const sampleJournalData = {
  'Nature': {
    title: 'Nature',
    issn: '0028-0836',
    publisher: 'Springer Nature',
    impactFactor: '64.8',
    openAccess: 'Hybrid',
    indexedIn: 'PubMed, Scopus, WOS',
    accredited: 'Yes',
    transformativeAgreement: 'Yes',
    crossref: true,
    pubmed: true,
    openAlex: true,
    lastUpdated: '2025-06-15'
  },
  'Science': {
    title: 'Science',
    issn: '0036-8075',
    publisher: 'American Association for the Advancement of Science',
    impactFactor: '63.7',
    openAccess: 'Hybrid',
    indexedIn: 'PubMed, Scopus, WOS',
    accredited: 'Yes',
    transformativeAgreement: 'No',
    crossref: true,
    pubmed: true,
    openAlex: true,
    lastUpdated: '2025-06-10'
  },
  'PLOS ONE': {
    title: 'PLOS ONE',
    issn: '1932-6203',
    publisher: 'Public Library of Science',
    impactFactor: '3.7',
    openAccess: 'Full',
    indexedIn: 'PubMed, Scopus, DOAJ',
    accredited: 'Yes',
    transformativeAgreement: 'Yes',
    crossref: true,
    pubmed: true,
    openAlex: true,
    lastUpdated: '2025-06-12'
  }
};

const sampleRemovedJournals = [
  { title: 'Journal of Questionable Studies', issn: '1234-5678', year_removed: '2024', last_review_date: '2024-03-15' },
  { title: 'International Journal of Non-credible Research', issn: '2345-6789', year_removed: '2023', last_review_date: '2023-06-22' },
  { title: 'Quick Publication Review', issn: '3456-7890', year_removed: '2023', last_review_date: '2023-11-05' },
  { title: 'Studies in Predatory Publishing', issn: '4567-8901', year_removed: '2022', last_review_date: '2022-09-30' },
  { title: 'Fast Science Express', issn: '5678-9012', year_removed: '2022', last_review_date: '2022-01-18' }
];

// ===================== UTILITIES =====================
function showLoading(msg){ 
  loadingMessage.querySelector('span').textContent = msg;
  loadingMessage.style.display='flex'; 
}

function hideLoading(){ 
  loadingMessage.style.display='none'; 
}

function showError(msg){ 
  errorMessage.textContent=msg; 
  errorMessage.style.display='block'; 
  setTimeout(()=>errorMessage.style.display='none',7000); 
}

function normalizeTitle(t){ 
  return (t||'').toLowerCase().replace(/[^a-z0-9]/g,' ').replace(/\s+/g,' ').trim(); 
}

function isISSN(s){ 
  return /\b\d{4}-?\d{3}[\dXx]\b/.test(s); 
}

function rawUrlFor(fname){ 
  return RAW_BASE + encodeURIComponent(fname); 
}

function parseCSV(text){
  const lines = text.split(/\r?\n/).filter(Boolean);
  if(lines.length < 2) return [];
  // detect delimiter
  const delimiter = (lines[0].split('|').length > lines[0].split(',').length) ? '|' : ',';
  const headers = lines[0].split(delimiter).map(h=>h.trim());
  return lines.slice(1).map(line=>{
    const parts = line.split(delimiter).map(p=>p.trim());
    let obj = {};
    headers.forEach((h,i)=>{ obj[h.toLowerCase()] = parts[i] || ''; });
    return obj;
  });
}

// ===================== LOAD LISTS =====================
async function loadAllLists(){
  showLoading('Loading journal lists...');
  
  let loadedSuccessfully = false;
  
  for(const [key,fname] of Object.entries(FILENAMES)){
    try{
      const res = await fetch(rawUrlFor(fname));
      if (res.ok) {
        const text = await res.text();
        journalLists[key] = parseCSV(text);
        loadedSuccessfully = true;
      } else {
        throw new Error(`HTTP ${res.status}`);
      }
    }catch(e){ 
      console.warn('Failed loading',fname,e); 
      // Load sample data if CSV loading fails
      if (key === 'removed') {
        journalLists[key] = sampleRemovedJournals;
      } else {
        // Convert sample data to CSV-like format
        journalLists[key] = Object.values(sampleJournalData).map(journal => ({
          title: journal.title,
          issn: journal.issn,
          publisher: journal.publisher
        }));
      }
    }
  }
  
  transformativeList = [];
  for(const t of TRANSFORMATIVE_FILES){
    try{
      const res = await fetch(rawUrlFor(t.file));
      if (res.ok) {
        const text = await res.text();
        const rows = parseCSV(text);
        rows.forEach(r=>{
          transformativeList.push({...r, link:t.link});
        });
        loadedSuccessfully = true;
      } else {
        throw new Error(`HTTP ${res.status}`);
      }
    }catch(e){ 
      console.warn('Failed loading transformative file',t.file,e); 
      // Add sample transformative data
      transformativeList.push({
        journal: 'Nature',
        publisher: 'Springer Nature',
        duration: '2023-2025',
        link: 'https://sanlic.ac.za/springer/'
      });
    }
  }
  
  hideLoading();
  
  if (!loadedSuccessfully) {
    showError('Using sample data. Could not load external CSV files due to CORS restrictions.');
  }
}

// ===================== AUTOCOMPLETE =====================
journalQuery.addEventListener('input', function(){
  const q = normalizeTitle(this.value||'');
  autocompleteResults.innerHTML=''; 
  autocompleteResults.style.display='none';
  
  if(q.length<2) return;
  
  const suggestions=[];
  for(const list of Object.values(journalLists)){
    for(const j of list){
      if(j.title && normalizeTitle(j.title).includes(q) && !suggestions.includes(j.title)){
        suggestions.push(j.title);
        if(suggestions.length>=8) break;
      }
    }
    if(suggestions.length>=8) break;
  }
  
  if(suggestions.length){
    for(const t of suggestions){
      const div=document.createElement('div');
      div.className='autocomplete-item'; 
      div.textContent=t;
      div.addEventListener('click',()=>{ 
        journalQuery.value=t; 
        autocompleteResults.style.display='none'; 
        runCheck(); 
      });
      autocompleteResults.appendChild(div);
    }
    autocompleteResults.style.display='block';
  }
});

document.addEventListener('click',e=>{ 
  if(!autocompleteResults.contains(e.target)&&e.target!==journalQuery) 
    autocompleteResults.style.display='none'; 
});

// ===================== SEARCH =====================
function findOffline(query){
  const qNorm=normalizeTitle(query);
  const issnQuery=isISSN(query)?query.replace('-','').toLowerCase():null;
  let flags={}, sample=null;
  
  for(const [key,arr] of Object.entries(journalLists)){
    if(key==='removed') continue;
    flags[key]=false;
    for(const j of arr){
      if(issnQuery && (j.issn||'').replace('-','').toLowerCase()===issnQuery){ 
        flags[key]=true; 
        sample=j; 
        break; 
      }
      if(normalizeTitle(j.title||'')===qNorm){ 
        flags[key]=true; 
        sample=j; 
        break; 
      }
    }
  }
  return {flags,sample};
}

function checkRemovedList(query){
  const qNorm=normalizeTitle(query);
  return journalLists.removed.find(j=>normalizeTitle(j.title||'')===qNorm);
}

// ===================== BUILD REPORT =====================
function buildReportText(query,offlineHit,removedHit){
  const f=offlineHit.flags||{}, 
        hit=offlineHit.sample||{title:query, issn:'N/A', publisher:'Unknown'};
  
  let recText='‚ö†Ô∏è Not found in major lists. Verify with librarian.';
  let recClass='not-recommended';
  
  if(f.dhet||f.scopus||f.wos){ 
    recText='‚úÖ Recommended: Appears in major credible indexes'; 
    recClass='recommended'; 
  }
  else if(f.doaj||f.ibss||f.scielo){ 
    recText='‚ö†Ô∏è Verify manually: Appears in minor indexes'; 
    recClass='verify'; 
  }
  
  if(removedHit){ 
    recText='‚ùå Not recommended: Appears on removed list'; 
    recClass='not-recommended'; 
  }
  
  // Transformative
  let trans = transformativeList.filter(t => 
    t.journal && normalizeTitle(t.journal) === normalizeTitle(hit.title)
  );
  
  let transText = 'Transformative: No';
  if(trans.length){
    const t=trans[0];
    transText=`Transformative: Yes (${t.publisher||t.journal})\nDuration: ${t.duration||''}\nüîó View Agreement: ${t.link}`;
  }

  const parts=[
`üîç Search: ${query}`,
`üìò Journal: ${hit.title||'N/A'}`,
`üìã ISSN: ${hit.issn||'N/A'}`,
`üè¢ Publisher: ${hit.publisher||'Unknown'}`,
`üí° ${transText}`,
``,
`=== LOCAL ACCREDITATION LISTS ===`,
`DHET:     ${f.dhet?'‚úÖ Found':'‚ùå Not found'}`,
`DOAJ:     ${f.doaj?'‚úÖ Found':'‚ùå Not found'}`,
`IBSS:     ${f.ibss?'‚úÖ Found':'‚ùå Not found'}`,
`Norwegian:${f.norwegian?'‚úÖ Found':'‚ùå Not found'}`,
`Other:    ${f.other?'‚úÖ Found':'‚ùå Not found'}`,
`SciELO:   ${f.scielo?'‚úÖ Found':'‚ùå Not found'}`,
`Scopus:   ${f.scopus?'‚úÖ Found':'‚ùå Not found'}`,
`WOS:      ${f.wos?'‚úÖ Found':'‚ùå Not found'}`,
``,
`=== RECOMMENDATION ===`,
`${recText}`
  ];
  
  return {text:parts.join('\n'),recClass,recText};
}

function showReport(text,recClass,recText){
  journalReport.textContent=text; 
  journalReport.style.display='block';
  recommendation.textContent=recText; 
  recommendation.className='recommendation '+recClass; 
  recommendation.style.display='block';
}

// ===================== RUN CHECK =====================
function runCheck(){
  const query = journalQuery.value.trim();
  if(!query) {
    showError('Please enter a journal title or ISSN');
    return;
  }
  
  showLoading('Checking journal...');
  
  // Simulate API call with timeout
  setTimeout(() => {
    const offlineHit = findOffline(query);
    const removedHit = checkRemovedList(query);
    const report = buildReportText(query, offlineHit, removedHit);
    
    hideLoading();
    showReport(report.text, report.recClass, report.recText);
  }, 1000);
}

// ===================== EVENT LISTENERS =====================
checkBtn.addEventListener('click', runCheck);

journalQuery.addEventListener('keypress', function(e) {
  if(e.key === 'Enter') runCheck();
});

copyReportBtn.addEventListener('click', function() {
  if(journalReport.textContent) {
    navigator.clipboard.writeText(journalReport.textContent)
      .then(() => alert('Report copied to clipboard!'))
      .catch(err => showError('Failed to copy: ' + err));
  } else {
    showError('No report to copy');
  }
});

downloadReportBtn.addEventListener('click', function() {
  if(journalReport.textContent) {
    const blob = new Blob([journalReport.textContent], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'journal-report.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  } else {
    showError('No report to download');
  }
});

showRemovedBtn.addEventListener('click', function() {
  // Populate the table with removed journals
  removedTableBody.innerHTML = '';
  journalLists.removed.forEach(journal => {
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${journal.title || 'N/A'}</td>
      <td>${journal.issn || 'N/A'}</td>
      <td>${journal.year_removed || journal.year || 'N/A'}</td>
      <td>${journal.last_review_date || 'N/A'}</td>
    `;
    removedTableBody.appendChild(row);
  });
  
  // Show the modal
  removedModal.style.display = 'flex';
});

closeRemoved.addEventListener('click', function() {
  removedModal.style.display = 'none';
});

copyRemovedBtn.addEventListener('click', function() {
  if(journalLists.removed.length) {
    const text = journalLists.removed.map(j => 
      `${j.title || 'N/A'}\t${j.issn || 'N/A'}\t${j.year_removed || j.year || 'N/A'}\t${j.last_review_date || 'N/A'}`
    ).join('\n');
    
    navigator.clipboard.writeText(text)
      .then(() => alert('Removed journals list copied to clipboard!'))
      .catch(err => showError('Failed to copy: ' + err));
  } else {
    showError('No removed journals data available');
  }
});

// Close modal when clicking outside
window.addEventListener('click', function(event) {
  if (event.target === removedModal) {
    removedModal.style.display = 'none';
  }
});

// Initialize the application
loadAllLists();
</script>
</body>
</html>
